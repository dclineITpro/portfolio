(function(){"use strict";let h=null,d=[];function m(c){return c.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(Boolean)}function w(c){const s=c.map(e=>m(e)),t=new Map;for(const e of s)new Set(e).forEach(n=>t.set(n,(t.get(n)||0)+1));const i=s.length||1;h=new Map,t.forEach((e,o)=>h.set(o,Math.log((i+1)/(e+1))+1)),d=s.map(e=>{const o=new Map;for(const r of e)o.set(r,(o.get(r)||0)+1);const n=new Map;return o.forEach((r,f)=>{const u=r/e.length*(h.get(f)||0);n.set(f,u)}),n})}function q(c){const s=m(c),t=new Map;for(const e of s)t.set(e,(t.get(e)||0)+1);const i=new Map;return t.forEach((e,o)=>{const n=e/s.length*(h.get(o)||0);i.set(o,n)}),i}function y(c,s){let t=0,i=0,e=0;c.forEach((n,r)=>{i+=n*n;const f=s.get(r)||0;t+=n*f}),s.forEach(n=>e+=n*n);const o=Math.sqrt(i)*Math.sqrt(e);return o?t/o:0}function E(c,s=4){if(!h||!d.length)return[];const t=q(c),i=d.map((e,o)=>({index:o,score:y(t,e)}));return i.sort((e,o)=>o.score-e.score),i.slice(0,s)}function _(c){const s=c.replace(/\r\n?/g,`
`).split(`
`).filter(e=>e.trim().length>0),t=[];for(const e of s){const o=[];let n="",r=!1;for(let f=0;f<e.length;f++){const u=e[f];u==='"'?r&&e[f+1]==='"'?(n+='"',f++):r=!r:u===","&&!r?(o.push(n),n=""):n+=u}o.push(n),t.push(o)}return{headers:t.shift()||[],rows:t}}function b(c,s){const t=s.length,i=c.map((e,o)=>{const n=s.map(l=>l[o]).filter(l=>l!==void 0),r=n.map(l=>Number(l)).filter(l=>!Number.isNaN(l)),f=r.length>=Math.max(3,Math.floor(n.length*.6)),u=new Set(n).size,M={header:e,count:n.length,distinct:u};if(f){const l=r.reduce((a,p)=>a+p,0)/(r.length||1),g=Math.sqrt(r.reduce((a,p)=>a+Math.pow(p-l,2),0)/(r.length||1)),k=r.map((a,p)=>({v:a,i:p,z:g?Math.abs((a-l)/g):0})).filter(a=>a.z>=3).slice(0,10);M.numeric={mean:l,std:g,anomalies:k}}return M});return{rows:t,columns:c.length,summary:i}}self.addEventListener("message",c=>{const s=c.data;try{if(s.type==="tfidf_build"){w(s.chunks),self.postMessage({type:"tfidf_ready"});return}if(s.type==="tfidf_topk"){const t=E(s.query,s.k??4);self.postMessage({type:"tfidf_topk_result",reqId:s.reqId,items:t});return}if(s.type==="csv_parse"){const{headers:t,rows:i}=_(s.text),e=b(t,i);self.postMessage({type:"csv_result",reqId:s.reqId,headers:t,rows:i,profile:e});return}}catch(t){self.postMessage({type:"error",reqId:s.reqId,message:(t==null?void 0:t.message)||String(t)})}})})();
//# sourceMappingURL=aiWorker-4443c434.js.map
